//
//  calcK.cpp
//  Simulation
//
//  Created by Xin Jiang on 2019/6/8.
//  Copyright Â© 2019 Xin Jiang. All rights reserved.
//

#include <stdio.h>

// psc = 1 - (1 - 0.5^k)^m
// find the min k which f(m, k) <= psc
//
// Param:
//  logm: log(m) in [0, 15)
//  psc: collision probablity in (10^-9, 1)
//
// Return:
//  if find k, return k in  range [0, 50)
//  else return -1
int Txilm_getK(int logm, double psc){
    const double DataTable[15][50] = {
    {   1.0,    0.5,    0.25,   0.125,  0.0625, 0.03125,    0.015625,   0.0078125,  0.00390625, 0.001953125,    0.0009765625,   0.00048828125,  0.000244140625, 0.0001220703125,    6.103515625e-05,    3.0517578125e-05,   1.52587890625e-05,  7.62939453125e-06,  3.814697265625e-06, 1.9073486328125e-06,    9.5367431640625e-07,    4.76837158203125e-07,   2.384185791015625e-07,  1.1920928955078125e-07, 5.960464477539063e-08,  2.9802322387695312e-08, 1.4901161193847656e-08, 7.450580596923828e-09,  3.725290298461914e-09,  1.862645149230957e-09,  9.313225746154785e-10,  4.656612873077393e-10,  2.3283064365386963e-10, 1.1641532182693481e-10, 5.820766091346741e-11,  2.9103830456733704e-11, 1.4551915228366852e-11, 7.275957614183426e-12,  3.637978807091713e-12,  1.8189894035458565e-12, 9.094947017729282e-13,  4.547473508864641e-13,  2.2737367544323206e-13, 1.1368683772161603e-13, 5.684341886080802e-14,  2.842170943040401e-14,  1.4210854715202004e-14, 7.105427357601002e-15,  3.552713678800501e-15,  1.7763568394002505e-15},
    {   1.0,    0.9990234375,   0.9436864852905273, 0.7369244238361716, 0.47553952495127305,    0.27202384332787144,    0.1457091502359843, 0.075434863403401,  0.03838295838357364,    0.01936047964396692,    0.009722821223700384,   0.004872097621848925,   0.002438725786469087,   0.001220032790978376,   0.0006101839517185237,  0.0003051338751445254,  0.00015257741367236122, 7.62913260210496e-05,   3.814631782672606e-05,  1.907332261996686e-05,  9.536702236911943e-06,  4.768361350215855e-06,  2.3841832330617763e-06, 1.1920922560193503e-06, 5.960462878817907e-07,  2.9802318390892424e-07, 1.4901160194646934e-07, 7.450580341572532e-08,  3.7252902318485326e-08, 1.8626451381287268e-08, 9.313225746154785e-09,  4.6566128730773926e-09, 2.3283064365386963e-09, 1.1641532182693481e-09, 5.820766091346741e-10,  2.9103830456733704e-10, 1.4551915228366852e-10, 7.275957614183426e-11,  3.637978807091713e-11,  1.8189894035458565e-11, 9.094947017729282e-12,  4.547473508864641e-12,  2.2737367544323206e-12, 1.1368683772161603e-12, 5.684341886080801e-13,  2.8421709430404007e-13, 1.4210854715202004e-13, 7.105427357601002e-14,  3.552713678800501e-14,  1.7763568394002505e-14},
    {   1.0,    1.0,    0.9999999999996793, 0.9999984121652503, 0.9984255544709855, 0.9582004552833966, 0.7929584325241055, 0.5435690025908804, 0.32388353489045263,    0.17757952140861422,    0.09308265650895886,    0.047666556568750074,   0.024121358687114514,   0.012133563764026856,   0.006085112149991745,   0.0030471523581468984,  0.0015247269688252185,  0.0007626513969993809,  0.0003813977035574956,  0.00019071685640814628, 9.536292978207239e-05,  4.768259033816058e-05,  2.3841576537453335e-05, 1.192085861156933e-05,  5.9604468916063524e-06, 2.9802278422863537e-06, 1.4901150202639712e-06, 7.450577849121842e-07,  3.725289611233862e-07,  1.8626449771463882e-07, 9.313225313167806e-08,  4.65661276205509e-08,   2.3283064143342358e-08, 1.1641532071671179e-08, 5.820766091346741e-09,  2.9103830456733704e-09, 1.4551915228366852e-09, 7.275957614183426e-10,  3.637978807091713e-10,  1.8189894035458565e-10, 9.094947017729282e-11,  4.547473508864641e-11,  2.2737367544323206e-11, 1.1368683772161603e-11, 5.6843418860808015e-12, 2.8421709430404007e-12, 1.4210854715202004e-12, 7.105427357601002e-13,  3.552713678800501e-13,  1.7763568394002505e-13},
    {   1.0,    1.0,    1.0,    1.0,    1.0,    0.9999999999999837, 0.9999998552643654, 0.9996075798421896, 0.9800374911305659, 0.858440454732242,  0.623576201943276,  0.3863929246479232, 0.2166458858594944, 0.11492046122177269,    0.05921158788752079,    0.030057069542824166,   0.015143078261349197,   0.007600393457481758,   0.00380743779932613,    0.0019055326148655904,  0.0009532201678953411,  0.00047672360306594275, 0.0002383901880657069,  0.00011920219151029254, 5.9602870230102134e-05, 2.9801878747015564e-05, 1.4901050283122608e-05, 7.45055286921481e-06,   3.725283366562415e-06,  1.8626434162838379e-06, 9.313221414064543e-07,  4.6566117894997205e-07, 2.3283061656442783e-07, 1.1641531505457436e-07, 5.820765924813287e-08,  2.9103830012644494e-08, 1.455191511734455e-08,  7.275957614183426e-09,  3.637978807091713e-09,  1.8189894035458565e-09, 9.094947017729282e-10,  4.547473508864641e-10,  2.2737367544323206e-10, 1.1368683772161603e-10, 5.6843418860808015e-11, 2.8421709430404007e-11, 1.4210854715202004e-11, 7.105427357601002e-12,  3.552713678800501e-12,  1.7763568394002505e-12},
    {   1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    0.9999999967685935, 0.9999428822983674, 0.9924333510236183, 0.9129875721552416, 0.7049993256963434, 0.4568502365999243, 0.2630096186457004, 0.14151756142125216,    0.073456456344838,  0.03742861122614316,    0.018892756222779528,   0.009491417149575687,   0.004757022078235251,   0.0023813461610217024,  0.0011913827060018312,  0.0005958688651107602,  0.0002979788238068881,  0.00014900051136967907, 7.450303075817732e-05,  3.725220917327743e-05,  1.8626278038391675e-05, 9.313182382508778e-06,  4.656602032193646e-06,  2.3283037262622486e-06, 1.1641525407002362e-06, 5.820764397146405e-07,  2.910382622678398e-07,  1.4551914173654978e-07, 7.2759573477299e-08,    3.6379787404783315e-08, 1.8189893924436262e-08, 9.094947017729282e-09,  4.547473508864641e-09,  2.2737367544323206e-09, 1.1368683772161603e-09, 5.684341886080801e-10,  2.842170943040401e-10,  1.4210854715202004e-10, 7.105427357601002e-11,  3.552713678800501e-11,  1.7763568394002505e-11},
    {   1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    0.9999999999751221, 0.9999950085113632, 0.9977654197967775, 0.952726452035874,  0.7825726588407262, 0.5337075951980735, 0.3171434386693266, 0.1736484950377133, 0.09096117788145874,    0.046564714945103836,   0.023559888946305674,   0.011850156888491226,   0.005942736326236431,   0.0029757957992927464,  0.0014890064586942087,  0.0007447805756285453,  0.0003724596502164834,  0.00018624716893878013, 9.312792083082666e-05,  4.6565044556245994e-05, 2.3282793319645556e-05, 1.164146442100833e-05,  5.820749150897697e-06,  2.9103788105055983e-06, 1.4551904640169866e-06, 7.275954967411735e-07,  3.6379781453987903e-07, 1.8189892381226258e-07, 9.094946606946763e-08,  4.547473408944569e-08,  2.27373673222786e-08,   1.13686836611393e-08,   5.6843418860808015e-09, 2.8421709430404007e-09, 1.4210854715202004e-09, 7.105427357601002e-10,  3.552713678800501e-10,  1.7763568394002505e-10},
    {   1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    0.9999999999999443, 0.9999997638752285, 0.999514059143167,  0.9779557733565344, 0.8515267470540678, 0.6146775532338038, 0.3792564665028958, 0.21212718743295456,    0.11237799499821188,    0.05786306294931032,    0.029362612564570845,   0.014790688406288943,   0.007422893852371271,   0.0037183600199170996,  0.0018609115040432167,  0.0009308890287806904,  0.00046555288402594375, 0.0002328035407301865,  0.00011640854583305771, 5.8205966882107774e-05, 2.910340694484148e-05,  1.4551809349838685e-05, 7.275931144468117e-06,  3.6379721896073747e-06, 1.8189877492025275e-06, 9.094942882148516e-07,  4.547472475247005e-07,  2.2737364957503559e-07, 1.1368683128232249e-07, 5.684341719547348e-08,  2.8421708986314798e-08, 1.4210854604179701e-08, 7.105427357601002e-09,  3.552713678800501e-09,  1.7763568394002505e-09},
    {   1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    0.9999999947942628, 0.9999278488772503, 0.9915058086433897, 0.9078360364079168, 0.6964147950090878, 0.4490143234380527, 0.2577159024634277, 0.13844089048703445,    0.07179791532704105,    0.03656755047290794,    0.018454051223011803,   0.009269991982930992,   0.004645787661891054,   0.0023255980337830717,  0.0011634758548563218,  0.0005819072354266153,  0.0002909959570325249,  0.00014550856488648733, 7.275692922836807e-05,  3.637912633447371e-05,  1.818972860034851e-05,  9.09490565881299e-06,   4.547463169135568e-06,  2.2737341695000524e-06, 1.1368677309553377e-06, 5.684340270706301e-07,  2.84217053891922e-07,   1.421085370489905e-07,  7.105427102249706e-08,  3.5527136121871195e-08, 1.7763568282980202e-08},
    {   1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    0.9999999999557807, 0.9999933502391452, 0.9974212865189569, 0.9492189630858247, 0.774653515577143,  0.5252932635049494, 0.3110103504740884, 0.16994599587439319,    0.08892700391373554,    0.04549856149609699,    0.02301410526605996,    0.011574031737700552,   0.005803858253999095,   0.002906151986642125,   0.0014541332450577205,  0.0007273311278109817,  0.00036373171428483175, 0.00018188239774552528, 9.094533439968355e-05,  4.5473701128617705e-05, 2.2737109052317628e-05, 1.136861914896592e-05,  5.6843257302263694e-06, 2.842166904049037e-06,  1.4210844617723595e-06, 7.105424832953844e-07,  3.552713048193823e-07,  1.776356681748581e-07},
    {   1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    0.999999999999886,  0.9999996623180312, 0.9994188958891657, 0.9758938987204729, 0.8447386031134531, 0.6059677715957554, 0.37228013533926874,    0.2077122589016286, 0.1098945337157462, 0.05654599142975203,    0.028684392912866286,   0.014446547828409595,   0.0072495519156676735,  0.0036313693796128366,  0.0018173360449549314,  0.0009090812368246493,  0.00045464396898142745, 0.0002273478280081509,  0.00011368037561798605, 5.684180330434163e-05,  2.8421305537484898e-05, 1.4210753741528137e-05, 7.105402114127024e-06,  3.552707367959762e-06,  1.7763552616623102e-06},
    {   1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    0.9999999999999999, 0.9999999918598035, 0.9999097769617459, 0.9905014191349589, 0.9025393368061234, 0.6878130957149469, 0.441263117115372,  0.2525129547013134, 0.13542666863922448,    0.07017564488703931,    0.03572599583257263,    0.018025456456502997,   0.009053713088592708,   0.004537149406664498,   0.0022711537730624176,  0.0011362223871876909,  0.0005682726605021893,  0.0002841767084519331,  0.00014209845021073697, 7.105174928090374e-05,  3.552650570670668e-05,  1.7763410622761988e-05},
    {   1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    0.9999999999226797, 0.9999912068028218, 0.997034667441728,  0.9455451328298086, 0.7666443333206914, 0.5169309918028854, 0.30496834014718877,    0.16631441187157303,    0.08693615331210491,    0.044456256005035666,   0.022480821674086382,   0.01130430448701003,    0.005668216583121444,   0.0028381357989674116,  0.0014200762077015705,  0.0007102903600485488,  0.0003552082664806111,  0.00017761990765607916},
    {   1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    0.9999999999997707, 0.9999995211676154, 0.9993080228438324, 0.9736945413235804, 0.8378104236502645, 0.5972723297936064, 0.36539171908453894,    0.2033769518049996, 0.10746257882651744,    0.055258013437803455,   0.0280216120909903, 0.014110357134729856,   0.007080243491313087,   0.0035464102585174295,  0.001774780051374103},
    {   1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    0.9999999999999999, 0.9999999874040945, 0.9998877685181948, 0.9894060639134714, 0.8970731517701331, 0.6791778557675917, 0.4335883614963243, 0.2473967589070053, 0.13247291621932844,    0.06858866026836885,    0.03490345574567966,    0.017606726277953233},
    {   1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    1.0,    0.9999999998665597, 0.9999884483673056, 0.9966012307088556, 0.9417010352480882, 0.7585482144362712, 0.5086225630294671, 0.29901680692720345,    0.16275260939624492},
    };
    
    if(logm < 0 || logm > 14)
        return -1;
    
    int start = 0;
    int end = 50;
    while(start <= end){
        int m = (start + end) / 2;
        if(DataTable[logm][m] == psc)
            return m;
        else if(psc < DataTable[logm][m])
            start = m + 1;
        else
            end = m - 1;
    }
    if(start > 49)
        return -1;
    else
        return start;
}
